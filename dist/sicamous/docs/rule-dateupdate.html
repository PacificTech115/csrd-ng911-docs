<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>6. DateUpdate — CSRD NG911 Attribute Rule</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@600;700;800&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="stylesheet" href="shared.css">
</head>
<body>

<div id="progress"></div>

<button class="mobile-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open')" aria-label="Toggle navigation">
  <i class="fas fa-bars"></i>
</button>

<!-- ── SIDEBAR ── -->

  <aside class="sidebar" id="sidebar">
    <div class="sidebar-brand">
      <img src="../csrd-logo.png" alt="NG911 CSRD Logo">
      <h2>Sicamous Portal</h2>
    </div>
    <nav class="sidebar-nav">
      <a href="guide-sicamous.html" class=""><i class="fas fa-home"></i> User Guide</a>
      <div class="nav-group-label" style="margin-top:20px;">Technical References</div>
      <a href="schema-guide.html" class="nav-indent"><i class="fas fa-table-columns"></i> Schema Guide</a>
      <a href="attribute-rules.html" class="nav-indent"><i class="fas fa-wand-magic-sparkles"></i> Attribute Rules</a>
      <a href="domains.html" class="nav-indent"><i class="fas fa-list-check"></i> Domains</a>
    </nav>
    <div class="sidebar-footer">CSRD NG911 &copy; 2026 &middot; Pacific Tech Systems</div>
  </aside>

<!-- ── MAIN ── -->
<div class="main">

  <!-- ── PAGE HEADER ── -->
  <header class="page-header">
    <div class="page-header-content">
      <div class="breadcrumb"><span class="current">Sicamous Reference</span></div>
      <div class="detail-banner">
        <div class="banner-icon" style="background:var(--navy)">
          <i class="fas fa-calendar"></i>
        </div>
        <div class="banner-info">
          <h1>6. DateUpdate</h1>
          <div class="banner-tags">
            <span class="banner-tag">Target: DateUpdate</span>
            <span class="banner-tag">Triggers: Insert / Update</span>
            <span class="banner-tag">Type: Calculation</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- ── CONTENT ── -->
  <div class="content-wrap">

    <!-- Description -->
    <section>
      <h2>Description</h2>
      <p class="reveal">
        The simplest attribute rule in the system. It sets the <code>DateUpdate</code> field to the feature's last edited timestamp on every save. This provides a reliable, auto-populated edit date that cannot be accidentally left blank or stale. The value comes from ArcGIS's built-in <code>last_edited_date</code> tracking field.
      </p>
    </section>

    <!-- Metadata -->
    <section>
      <h2>Metadata</h2>
      <div class="reveal">
        <table>
          <thead>
            <tr><th>Property</th><th>Value</th></tr>
          </thead>
          <tbody>
            <tr><td>Target Field</td><td><code>DateUpdate</code></td></tr>
            <tr><td>Triggers</td><td>Insert, Update</td></tr>
            <tr><td>Input</td><td><code>$feature.last_edited_date</code> (system field)</td></tr>
            <tr><td>Returns</td><td>Timestamp of the last edit</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Full Source Code -->
    <section>
      <h2>Full Source Code</h2>
      <div class="code-block reveal">
        <div class="code-header">
          <span class="lang-tag">Arcade</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre>
<span class="code-section" data-section="1"><span class="var">$feature</span>.last_edited_date</span>
</pre>
      </div>
      <div class="section-popup" id="sectionPopup"></div>
    </section>

    <!-- Section Breakdown -->
    <section>
      <h2>Section Breakdown</h2>

      <div class="breakdown-card reveal" style="border-left-color:var(--navy)" data-section="1">
        <h4>1. Timestamp Assignment</h4>
        <div class="breakdown-meta">
          <span class="meta-tag">Line 1</span>
          <span class="meta-tag">Input: last_edited_date (system)</span>
          <span class="meta-tag">Output: Date</span>
        </div>
        <p>Returns the system-tracked <code>last_edited_date</code> value. ArcGIS Enterprise maintains this automatically on every Insert and Update. No conditional logic—single expression.</p>
        <div class="breakdown-detail">
          <strong>Logic</strong>
          <ul>
            <li><code>return $feature.last_edited_date;</code></li>
          </ul>
          <strong>To replicate</strong>
          <ul>
            <li>Target field: <code>DateUpdate</code> (or equivalent). Set rule triggers: Insert, Update.</li>
          </ul>
          <strong>To modify</strong>
          <ul>
            <li>Date-only (no time): <code>DateOnly($feature.last_edited_date)</code></li>
            <li>Formatted string: <code>Text($feature.last_edited_date, "yyyy-MM-dd")</code></li>
            <li>If ArcGIS renames the field in a future version, update the reference.</li>
          </ul>
          <strong>Dependencies</strong>
          <ul>
            <li><code>last_edited_date</code> is a system-managed field; do not edit manually.</li>
          </ul>
        </div>
      </div>

    </section>

  </div><!-- /content-wrap -->

  <!-- ── FOOTER ── -->
  <footer class="site-footer">
    <img src="../csrd-logo.png" alt="NG911 CSRD Logo">
    <p>CSRD NG911 Documentation</p>
    <p class="sub">Columbia Shuswap Regional District — Next Generation 911</p>
  </footer>

</div><!-- /main -->

<!-- ── BACK TO TOP ── -->
<button class="back-to-top" id="backToTop" onclick="window.scrollTo({top:0,behavior:'smooth'})" aria-label="Back to top">
  <i class="fas fa-chevron-up"></i>
</button>

<script>
// ── Scroll-reveal observer ──
(function(){
  const io=new IntersectionObserver(entries=>{
    entries.forEach(e=>{if(e.isIntersecting){e.target.classList.add('visible');io.unobserve(e.target)}});
  },{threshold:.08,rootMargin:'0px 0px -40px 0px'});
  document.querySelectorAll('.reveal').forEach(el=>io.observe(el));
})();

// ── Reading progress bar ──
(function(){
  const bar=document.getElementById('progress');
  function update(){
    const st=window.scrollY,h=document.documentElement.scrollHeight-window.innerHeight;
    bar.style.width=(h>0?Math.min(st/h*100,100):0)+'%';
  }
  window.addEventListener('scroll',update,{passive:true});update();
})();

// ── Back-to-top toggle ──
(function(){
  const btt=document.getElementById('backToTop');
  window.addEventListener('scroll',function(){
    btt.classList.toggle('visible',window.scrollY>400);
  },{passive:true});
})();

// ── Copy to clipboard ──
function copyCode(btn){
  const pre=btn.closest('.code-block').querySelector('pre');
  const text=pre.textContent;
  navigator.clipboard.writeText(text).then(()=>{
    btn.textContent='Copied!';btn.classList.add('copied');
    setTimeout(()=>{btn.textContent='Copy';btn.classList.remove('copied')},1500);
  });
}

// ── Section hover interaction ──
(function(){
  const popup=document.getElementById('sectionPopup');
  const sections=document.querySelectorAll('.code-section');
  const cards=document.querySelectorAll('.breakdown-card[data-section]');
  const META=[
    {title:'Timestamp Assignment',lines:'Line 1',fields:'last_edited_date',desc:'Returns the system-tracked last_edited_date value maintained by ArcGIS Enterprise.',maint:'Update field reference if system field name changes in future ArcGIS version.'}
  ];
  sections.forEach(span=>{
    span.addEventListener('mouseenter',function(e){
      const idx=parseInt(this.dataset.section);const m=META[idx-1];if(!m)return;
      this.classList.add('active');
      cards.forEach(c=>c.classList.toggle('highlight',parseInt(c.dataset.section)===idx));
      popup.innerHTML='<h4><span class="popup-num">'+idx+'</span>'+m.title+'</h4>'
        +'<div class="popup-meta">'+(m.lines?'<span class="popup-tag">'+m.lines+'</span>':'')
        +(m.fields?'<span class="popup-tag">Fields: '+m.fields+'</span>':'')+'</div>'
        +'<p>'+m.desc+'</p>'
        +(m.maint?'<div class="popup-maint"><strong>Maintenance:</strong> '+m.maint+'</div>':'');
      popup.classList.add('visible');
    });
    span.addEventListener('mousemove',function(e){
      const x=Math.min(e.clientX+16,window.innerWidth-360);
      const y=Math.min(e.clientY-10,window.innerHeight-popup.offsetHeight-10);
      popup.style.left=x+'px';popup.style.top=Math.max(10,y)+'px';
    });
    span.addEventListener('mouseleave',function(){
      this.classList.remove('active');popup.classList.remove('visible');
      cards.forEach(c=>c.classList.remove('highlight'));
    });
  });
  cards.forEach(card=>{
    const idx=parseInt(card.dataset.section);
    const codeSection=document.querySelector('.code-section[data-section="'+idx+'"]');
    if(codeSection){
      const reveal=document.createElement('div');
      reveal.className='breakdown-code-reveal';
      const pre=document.createElement('pre');
      pre.textContent=codeSection.textContent;
      reveal.appendChild(pre);
      card.parentNode.insertBefore(reveal,card.nextSibling);
    }
    card.addEventListener('mouseenter',function(){
      const idx=parseInt(this.dataset.section);
      sections.forEach(s=>s.classList.toggle('active',parseInt(s.dataset.section)===idx));
      this.classList.add('highlight');
    });
    card.addEventListener('mouseleave',function(){
      sections.forEach(s=>s.classList.remove('active'));this.classList.remove('highlight');
    });
    card.addEventListener('click',function(e){
      e.preventDefault();
      const rev=this.nextElementSibling;
      if(rev&&rev.classList.contains('breakdown-code-reveal'))rev.classList.toggle('visible');
    });
  });
})();
</script>
<script src="editor-core.js"></script>
</body>
</html>
